language: python
# use container-based infrastructure
sudo: false
cache:
  pip: true
  directories:
   - test/data/nidmresults-examples
  timeout: 1000
python:
  - "3.5"
bundler_args: --retry 9
# command to install dependencies, e.g. pip install -r requirements.txt --use-mirrors
install: 
 - pip install --upgrade setuptools
  # Install nidmresults from source in GitHub repo
 - pip install --upgrade --no-deps git+https://github.com/cmaumet/nidmresults.git
 - pip install -r requirements.txt
 - cd test/data/nidmresults-examples
 - ls
 # Is this is not a git repo them clone nidmresults-examples
 - if ! [ -d .git ]; then git lfs clone https://github.com/incf-nidash/nidmresults-examples.git .; fi
 - ls
 - git pull
 - ls
 - cd ../../..
script:  
# Run octave
- octave --eval "addpath(fullfile(pwd, 'spm12')); disp(spm('version')); nidm_export_all('test/data/nidmresults-examples/', './spmexport')"
- python TestSPMResultDataModel.py
- cat debug.log
before_install: 
 - git config --global user.name "TravisCI"
 - git config --global user.email "travis@dummy.com"
 - git clone https://github.com/spm/spm12.git
 # Install updated version of GraphicsMagick
 # to avoid 'your version of GraphicsMagick limits images to 8 bits per pixel
 - sudo apt-get install python-software-properties
 - sudo apt-get install software-properties-common
 - sudo add-apt-repository -y ppa:rwky/graphicsmagick
 - sudo apt-get update
 - sudo apt-get install graphicsmagick
  # Rebuild octave with links to updated GraphicsMagick
 - sudo apt-get build-dep octave
 - curl -sLo - ftp://ftp.gnu.org/gnu/octave/octave-4.2.1.tar.gz | tar xzvf -
 - cd octave-4.2.1
 - ./configure
 - make
 - sudo make install
 - cd ..
 # # 
 # - sudo apt-get install octave
 # - octave --version
 #  # Install Octave dev tools (mkoctfile) required to compile 
 # MEX files
 - sudo apt-get install liboctave-dev
 # Compile SPM MEX files for octave
 - cd spm12/src
 - make PLATFORM=octave && make install PLATFORM=octave
 - cd ../..
 # # Rebuild GraphicsMagick for Octave
 # # cf. https://wiki.octave.org/GraphicsMagick
 # - ./configure  --with-quantum-depth=16 --enable-shared --disable-static --with-magick-plus-plus=yes
 # - make
 # - make check
 # - sudo make install


